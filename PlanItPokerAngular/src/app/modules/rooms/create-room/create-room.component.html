<h2 mat-dialog-title>
  {{ roomData().id ? 'Edit Room' : 'Create Planning Room' }}
</h2>

<mat-dialog-content>
  <form #form="ngForm" class="form-container">
    <!-- Room Name -->
    <mat-form-field class="full-width-field">
      <mat-label>Room Name</mat-label>
      <input
        matInput
        [(ngModel)]="roomData().name"
        name="roomName"
        required
        minlength="3"
        #nameInput="ngModel"
      >
      <mat-error *ngIf="nameInput.invalid && (nameInput.dirty || nameInput.touched)">
        <span *ngIf="nameInput.errors?.['required']">Room name is required</span>
        <span *ngIf="nameInput.errors?.['minlength']">Minimum 3 characters required</span>
      </mat-error>
    </mat-form-field>

    <!-- Card Type Selection -->
    <mat-form-field class="full-width-field">
      <mat-label>Estimation Style</mat-label>
      <mat-select [(ngModel)]="selectedConfig" name="cardType">
        <mat-option 
          *ngFor="let config of availableConfigs()" 
          [value]="config"
          (onSelectionChange)="onConfigChange(config)"
        >
          {{ getCardLabel(config.type) }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Custom Cards Dropdown -->
    <mat-expansion-panel
        [expanded]="customizationExpanded()"
        (opened)="customizationExpanded.set(true)"
        (closed)="customizationExpanded.set(false)"
      >
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>edit</mat-icon>
          Customize Cards
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div class="card-editor">
        <div class="editor-actions">
          <button mat-icon-button (click)="addCard()">
            <mat-icon>add_circle</mat-icon>
          </button>
          <button 
            mat-icon-button 
            (click)="saveAsNewConfig()"
            matTooltip="Save as new configuration"
          >
            <mat-icon>save</mat-icon>
          </button>
        </div>

        <div *ngFor="let card of editingCards(); let index = index" class="card-row">
          <mat-form-field>
            <input
              matInput
              [(ngModel)]="editingCards()[index]"
              [name]="'card-' + index"
              required
            >
          </mat-form-field>
          <button 
            mat-icon-button 
            color="warn" 
            (click)="removeCard(index)"
            [disabled]="editingCards().length <= 1"
          >
            <mat-icon>remove_circle</mat-icon>
          </button>
        </div>
      </div>
    </mat-expansion-panel>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="closeDialog()">Cancel</button>
  <button 
    mat-raised-button 
    color="primary"
    (click)="submit()"
    [disabled]="!isFormValid"
  >
    {{ roomData().id ? 'Save Changes' : 'Create Room' }}
  </button>
</mat-dialog-actions>